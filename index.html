<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Chat Simple</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #e5ddd5; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        
        /* Écran de connexion */
        #login-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; background: #075e54; color: white; }
        #login-screen input { padding: 12px; border-radius: 8px; border: none; width: 250px; margin-bottom: 10px; }
        #login-screen button { padding: 10px 25px; border-radius: 8px; border: none; background: #25d366; color: white; font-weight: bold; cursor: pointer; }

        /* Fenêtre de chat */
        #chat-screen { display: none; flex-direction: column; height: 100%; }
        header { background: #075e54; color: white; padding: 15px; font-size: 1.2em; font-weight: bold; }
        
        #messages { flex: 1; overflow-y: auto; padding: 20px; list-style: none; display: flex; flex-direction: column; gap: 10px; }
        
        /* Bulles de message */
        .msg { max-width: 70%; padding: 8px 15px; border-radius: 15px; font-size: 14px; position: relative; word-wrap: break-word; }
        .mine { align-self: flex-end; background: #dcf8c6; border-top-right-radius: 0; }
        .others { align-self: flex-start; background: white; border-top-left-radius: 0; }
        .system { align-self: center; background: #fff3cd; font-style: italic; font-size: 12px; color: #856404; border-radius: 5px; }
        
        .user-name { font-weight: bold; font-size: 12px; display: block; color: #075e54; }
        .time { font-size: 10px; color: #999; text-align: right; display: block; margin-top: 5px; }

        /* Zone de saisie */
        .input-area { background: #f0f0f0; padding: 15px; display: flex; gap: 10px; }
        #input { flex: 1; border: none; padding: 12px; border-radius: 25px; outline: none; }
        #send-btn { background: #075e54; color: white; border: none; padding: 0 20px; border-radius: 50%; cursor: pointer; font-size: 1.2em; }
    </style>
</head>
<body>

    <div id="login-screen">
        <h1>Bienvenue</h1>
        <input type="text" id="username-input" placeholder="Choisissez un pseudo...">
        <button onclick="joinChat()">Rejoindre le chat</button>
    </div>

    <div id="chat-screen">
        <header>Messagerie Université</header>
        <ul id="messages"></ul>
        <form id="form" class="input-area">
            <input id="input" autocomplete="off" placeholder="Tapez votre message..." />
            <button id="send-btn">➤</button>
        </form>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        var socket = io();
        var currentUsername = "";

        function joinChat() {
            var input = document.getElementById('username-input');
            currentUsername = input.value.trim();
            if (currentUsername !== "") {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('chat-screen').style.display = 'flex';
                socket.emit('user joined', currentUsername);
            }
        }

        var form = document.getElementById('form');
        var input = document.getElementById('input');

        form.addEventListener('submit', function(e) {
            e.preventDefault();
            if (input.value) {
                socket.emit('chat message', { user: currentUsername, text: input.value });
                input.value = '';
            }
        });

        // Afficher les messages des utilisateurs
        socket.on('chat message', function(data) {
            var item = document.createElement('li');
            var isMine = data.user === currentUsername;
            
            item.className = 'msg ' + (isMine ? 'mine' : 'others');
            item.innerHTML = `
                <span class="user-name">${isMine ? 'Moi' : data.user}</span>
                ${data.text}
                <span class="time">${data.time}</span>
            `;
            
            document.getElementById('messages').appendChild(item);
            document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
        });

        // Afficher les messages système (connexion/déconnexion)
        socket.on('system message', function(text) {
            var item = document.createElement('li');
            item.className = 'msg system';
            item.textContent = text;
            document.getElementById('messages').appendChild(item);
        });
    </script>
</body>
</html>